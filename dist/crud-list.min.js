!function(){"use strict";var vvvCrudListController=function($scope){var actionConfirmations={remove:{yesText:"remove_completely",noText:"cancel"}},actionCssClasses={"new":"btn-primary",remove:"btn-danger btn-xs",edit:"btn-info btn-md"};$scope.errors=[],$scope.showActions={},$scope.columns=$scope.options.columns,$scope.modelName=$scope.options.modelName,$scope.rowStates={},$scope.idField=$scope.options.idField||"id",$scope.multiSelect={checkedAll:!1,selectedRows:{},enabled:!1},$scope.toggleMultiSelect=function(){$scope.multiSelect.enabled?$scope.disableMultiSelect():$scope.enableMultiSelect()},$scope.enableMultiSelect=function(){$scope.multiSelect.enabled=!0},$scope.disableMultiSelect=function(){$scope.multiSelect.enabled=!1,$scope.multiSelect.selectedRows={},$scope.multiSelect.checkedAll=!1,multiSelectOnChange()},$scope.multiSelectToggleAll=function(){if($scope.multiSelect.checkedAll){var i,rowIds=($scope.dataSource.filteredRows()||[]).map($scope.rowId);for(i in rowIds)$scope.multiSelect.selectedRows[rowIds[i]]=!0}else $scope.multiSelect.selectedRows={};multiSelectOnChange()},$scope.checkAllRowsSelected=function(){return $scope.multiSelect.checkedAll=$scope.dataSource.filteredRows().length==$scope.getSelectedRowIds().length,multiSelectOnChange(),$scope.multiSelect.checkedAll},$scope.getSelectedRowIds=function(){var id,selectedIds=[];for(id in $scope.multiSelect.selectedRows)$scope.multiSelect.selectedRows[id]&&selectedIds.push(id);return selectedIds},$scope.rowTpl=function(row){return $scope.rowStates[$scope.rowId(row)]&&"edit"===$scope.rowStates[$scope.rowId(row)][0]?"crud-list/edit_row.html":"crud-list/row.html"},$scope.cellTpl=function(column){return column.templateUrl?column.templateUrl:column.url?"crud-list/link.html":"crud-list/plain_value.html"},$scope.formattedValue=function(row,column){var value=oValue(row,column.fieldId.split("."));return column.formatter&&angular.isFunction(column.formatter)?column.formatter(value):value},$scope.newRowTpl=function(){return $scope.row&&$scope.rowStates["new"]&&"edit"===$scope.rowStates["new"][0]?"crud-list/add_form.html":""},$scope["new"]=function(){return $scope.row=$scope.dataSource.newRecord(),$scope.row},$scope.cancel=function(row){$scope.rowStates[$scope.rowId(row)]=null},$scope.save=function(row,oForm){return oForm.$invalid?!1:(clearRowErrors(row),void $scope.dataSource.save(row,!0,onSuccessSave))},$scope.remove=function(row){var rid=$scope.rowId(row);return $scope.dataSource.remove(rid),$scope.rowStates[rid]=null,row},$scope.actionUrl=function(action,row){if(action.url){var resUrl=action.url;return 0===resUrl.indexOf("/")&&(resUrl="#"+resUrl),row?populateUrl(resUrl,row):resUrl}return""},$scope.doAction=function(event,action,row,confirmed){return $scope.actionDisabled(action,row)?!1:(event&&event.stopImmediatePropagation&&event.stopImmediatePropagation(),action.confirmation&&!confirmed?($scope.rowStates[$scope.rowId(row)]=["confirmation",action],event.preventDefault(),!1):(row=callAction(action,row),action.templateUrl?($scope.rowStates[$scope.rowId(row)]=["edit",action],preventDefault(event)):$scope.rowStates[$scope.rowId(row)]=null,action.url&&""!==action.url||preventDefault(event),!0))},$scope.actionCssClass=function(action){return action.cssClass||actionCssClasses[action.name]||""},$scope.actionShowed=function(action,row){return action.showedWhen?action.showedWhen(row,$scope):!0},$scope.actionDisabled=function(action,row){return action.activeWhen?!action.activeWhen(row,$scope):!1},$scope.rowState=function(row){return $scope.rowStates[$scope.rowId(row)]?$scope.rowStates[$scope.rowId(row)][0]||"":""},$scope.rowAction=function(row){return $scope.rowStates[$scope.rowId(row)]&&$scope.rowStates[$scope.rowId(row)][1]?$scope.rowStates[$scope.rowId(row)][1]:{}},$scope.rowConfirmation=function(row){return $scope.rowAction(row).confirmation||{}},$scope.rowId=function(row){return row&&row[$scope.idField]?row[$scope.idField]:"new"};var preventDefault=function(event){event&&event.preventDefault&&event.preventDefault()},callAction=function(action,row){var results;return action.before&&angular.isFunction(action.before)&&action.before(row,$scope),action.action&&angular.isFunction(action.action)&&(results=action.action(row,$scope)),action.after&&angular.isFunction(action.after)&&action.after(row||results,$scope),row||results},checkRowActions=function(){checkActions("row")},checkListActions=function(){checkActions("list")},checkActions=function(target){var actions,action,actionName,actionsLength=0;if(target+="Actions",$scope[target]={},$scope.options[target]){actions=$scope.options[target];for(actionName in actions){if(action=actions[actionName],action.name=actionName,!isActionCorrect(action))return!1;$scope[target][actionName]=action,actionsLength+=1}}$scope.showActions[target]=actionsLength>0},isActionCorrect=function(action){var allowedActions=["new","remove"];if(action.title&&""!==action.title||(action.title=action.name),action.showedWhen&&!angular.isFunction(action.showedWhen)&&(action.showedWhen=null,$scope.errors.push('Action "'+action.name+'".showedWhen should be a function.')),action.activeWhen&&!angular.isFunction(action.activeWhen)&&(action.activeWhen=null,$scope.errors.push('Action "'+action.name+'".activeWhen should be a function.')),action.action&&-1!==allowedActions.indexOf(action.action)&&(action.action=$scope[action.action]),!(action.url&&""!==action.url||action.action&&angular.isFunction(action.action)))if(-1!==allowedActions.indexOf(action.name))action.action=$scope[action.name],action.confirmation!==!1&&!action.confirmation&&actionConfirmations[action.name]&&(action.confirmation=actionConfirmations[action.name]);else if(!action.templateUrl||""===action.templateUrl)return $scope.errors.push('Action "'+action.name+'" has nothing to do.'),!1;return!0},checkColumns=function(){var i,column;for(i=0;i<$scope.columns.length;i++)column=$scope.columns[i],column.fieldId?(column.title||(column.title=column.fieldId),column.titlePrefix&&(column.prefix=column.titlePrefix,$scope.modelName&&(column.prefix+="."+$scope.modelName))):$scope.errors.push("Column "+i+" has no fieldId.")},populateUrl=function(url,data){var i,places,property;if(places=url.match(/\:[^\/\:\.]+/g))for(i=0;i<places.length;i++)property=places[i].replace(":",""),data.hasOwnProperty(property)&&(url=url.replace(places[i],data[property]));return url},onSuccessSave=function(row){$scope.rowStates[$scope.rowId(row)]=null,$scope.row&&$scope.row.id==row.id&&($scope.row=null)},clearRowErrors=function(row){row.errors={}},oValue=function(obj,keys){var key;return key=keys.shift(),keys.length>0&&obj[key]&&"object"==typeof obj[key]?oValue(obj[key],keys):obj[key]},checkMultiSelectOptions=function(){$scope.options.multiSelect||($scope.options.multiSelect={}),angular.merge($scope.multiSelect,$scope.options.multiSelect),$scope.multiSelect.onChange&&!angular.isFunction($scope.multiSelect.onChange)&&($scope.errors.push("multiSelect.onChange should be a function."),$scope.multiSelect.onChange=null)},multiSelectOnChange=function(){$scope.multiSelect.onChange&&$scope.multiSelect.onChange($scope)};return checkColumns(),checkRowActions(),checkListActions(),checkMultiSelectOptions(),!0};angular.module("vasvitaly.angular-crud-list",["vasvitaly.i18n"]).directive("vvvCrudList",[function(){return{restrict:"AE",templateUrl:"crud-list/main.html",scope:{options:"=",dataSource:"=source"},controllerAs:"crudList",controller:["$scope",vvvCrudListController]}}])}(),function(){"use strict";angular.module("vasvitaly.i18n",[]).filter("i18n",function(){return function(key,prefix){if(prefix)switch(prefix=prefix.split("."),prefix[0]){case"ARA":prefix=["activerecord","attributes"].concat(prefix.slice(1,prefix.length));break;case"ARM":prefix=["activerecord","models"].concat(prefix.slice(1,prefix.length));break;case"enum":prefix=["enumerize","defaults"].concat(prefix.slice(1,prefix.length))}else prefix=[];return prefix.push(key),window.I18n.t(prefix.join("."),{defaultValue:key})}})}(),function(){"use strict";var vvvPaginationController=function($scope){var self,source,paginationInfo;self=this,self.options={showPreviousPage:!0,showNextPage:!0,maxPages:10},angular.merge(self.options,$scope.settings),self.options.maxPages<5&&(self.options.maxPages=5),paginationInfo={totalCount:0,perPage:1},source=$scope.source,$scope.$watch(function(){return isPaginationInfoCompliant()?source.paginationInfo():!1},function(newValue,oldValue){newValue&&(paginationInfo=source.paginationInfo())}),self.isVisible=function(){return maxPage()>1},self.setPage=function(page){page&&page!=paginationInfo.page&&page>0&&page<=maxPage()&&source.paginate(page)},self.previousPage=function(){var res=paginationInfo.page-1;return 0>=res&&(res=!1),res},self.nextPage=function(){var nextPage=paginationInfo.page+1;return nextPage>maxPage()&&(nextPage=!1),nextPage},self.havePreviousPage=function(){return self.options.showPreviousPage&&!!self.previousPage()},self.haveNextPage=function(){return self.options.showNextPage&&!!self.nextPage()},self.isCurrentPage=function(page){return page==paginationInfo.page},self.firstItemNumber=function(){return(paginationInfo.page-1)*paginationInfo.perPage+1},self.lastItemNumber=function(){return paginationInfo.page*paginationInfo.perPage},self.totalCount=function(){return paginationInfo.totalCount},self.pages=function(){var pages;return pages=fillNearRange(),pages=fillLowerRange(pages),pages=fillUpperRange(pages),pages=fillUpLowerRange(pages)};var fillNearRange=function(){var pages=[],currPage=paginationInfo.page;return currPage>2&&pages.push(currPage-1),pages.push(currPage),currPage+1<maxPage()&&pages.push(currPage+1),pages},fillLowerRange=function(pages){for(var k,page,maxPages=(paginationInfo.page,self.options.maxPages),slots=Math.ceil((maxPages-5)/10*3),level=1;slots>0;)k=Math.pow(10,level),page=Math.floor((pages[0]-1)/k)*k,page?(page<pages[0]&&(pages.unshift(page),slots-=1),level+=1):slots=0;return 1!=pages[0]&&pages.unshift(1),pages},fillUpperRange=function(pages){for(var k,page,maxPages=(paginationInfo.page,self.options.maxPages),slots=maxPages-pages.length-1,upperPages=[],lastPage=pages[pages.length-1],level=1,full=!1;!full&&slots;)k=Math.pow(10,level),page=Math.ceil((lastPage+1)/k)*k,page<maxPage()?(upperPages.push(page),lastPage=page,slots-=1,level+=1):full=!0;for(var max=upperPages[0]||maxPage();slots;)page=pages[pages.length-1]+1,max>page?(pages.push(page),slots-=1):slots=0;return pages=pages.concat(upperPages),pages[pages.length-1]<maxPage()&&pages.push(maxPage()),pages},fillUpLowerRange=function(pages){for(var page,currPage=paginationInfo.page,idx=pages.indexOf(currPage-1),capacity=self.options.maxPages-pages.length,full=!1;capacity&&!full;)page=pages[idx]-1,page>1?page>pages[idx-1]?(pages.splice(idx,0,page),capacity-=1):idx-=1:full=!0;return pages},maxPage=function(){return Math.ceil(paginationInfo.totalCount/paginationInfo.perPage)},isPaginationInfoCompliant=function(){if(source&&source.paginationInfo()){var pinfo=source.paginationInfo();return pinfo.page&&pinfo.perPage&&pinfo.totalCount}return!1};return self};angular.module("vasvitaly.angular-pagination",["vasvitaly.i18n"]).directive("vvvPagination",[function(){return{restrict:"EA",templateUrl:"pagination/pagination.html",scope:{source:"=",settings:"=options"},controller:["$scope",vvvPaginationController],controllerAs:"pagination"}}])}(),angular.module("vasvitaly.angular-crud-list").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("crud-list/add_form.html",'<h2 class="sub-header">{{\'add_new.\'+modelName | i18n }}</h2><div class="row"><div class="col-md-12" ng-include="rowAction().templateUrl"></div></div>'),$templateCache.put("crud-list/edit_row.html",'<td class="row" colspan="{{columns.length+1}}"><div class="col-md-12" ng-include="rowAction(row).templateUrl"></div></td>'),$templateCache.put("crud-list/link.html",'<a ng-bind="formattedValue(row, column)" ng-href="{{actionUrl(column, row)}}" target="_blank"></a>'),$templateCache.put("crud-list/main.html",'<div ng-if="errors.length &gt; 0"><p ng-bind="error" ng-repeat="error in errors"></p></div><div ng-if="errors.length == 0"><div class="row listActionsPanel" ng-if="showActions.listActions"><div class="listActions" ng-if="rowState() !== &#39;confirmation&#39;"><span ng-repeat="action in listActions"><a class="btn" ng-class="actionCssClass(action)" ng-click="doAction($event, action, row)" ng-disabled="actionDisabled(action)" ng-href="{{actionUrl(action)}}" ng-show="actionShowed(action)" target="_blank">{{ action.title | i18n }}</a>&nbsp;</span></div><div class="action-confirmation-block" ng-if="rowState() == &#39;confirmation&#39;"><span class="question" ng-bind="rowConfirmation().text"></span><a class="btn btn-danger btn-xs" ng-click="doAction($event, rowAction(), null, true)" ng-href="{{actionUrl(rowAction())}}" target="_blank">{{ rowConfirmation().yesText || \'sure\' | i18n }}</a>&nbsp;<button class="btn btn-default btn-md" ng-click="cancel()">{{ rowConfirmation().noText || \'cancel\' | i18n }}</button></div></div><div class="row new-item-block" ng-include="newRowTpl()"></div><br><div class="row items-list"><div class="table-responsive"><table class="table table-striped"><thead><tr><th ng-if="multiSelect.enabled"><input ng-click="multiSelectToggleAll()" ng-model="multiSelect.checkedAll" type="checkbox"></th><th ng-class="{&#39;clickable&#39;: !column.notSortable}" ng-click="dataSource.sortBy(column.fieldId)" ng-repeat="column in columns" width="{{column.width || &#39;*&#39;}}"><span class="icon" ng-class="{ordered: dataSource.isOrderedByField(column.fieldId), reverse: dataSource.sortingInfo().desc}" ng-if="!column.notSortable"></span><span ng-bind="column.title | i18n : column.prefix"></span></th><th ng-show="showActions">{{\'actions\' | i18n}}</th></tr></thead><tbody><tr ng-include="rowTpl(row)" ng-repeat="row in dataSource.filteredRows()"></tr></tbody></table></div></div></div>'),$templateCache.put("crud-list/plain_value.html",'<span ng-bind="formattedValue(row, column)"></span>'),$templateCache.put("crud-list/row.html",'<td ng-if="multiSelect.enabled"><input ng-click="checkAllRowsSelected()" ng-model="multiSelect.selectedRows[rowId(row)]" type="checkbox"></td><td ng-include="cellTpl(column)" ng-repeat="column in columns"></td><td class="actions" ng-if="showActions.rowActions"><div class="action-block" ng-show="rowState(row) !== &#39;confirmation&#39;"><span ng-repeat="action in rowActions"><a class="btn" ng-class="actionCssClass(action)" ng-click="doAction($event, action, row)" ng-disabled="actionDisabled(action, row)" ng-href="{{actionUrl(action, row)}}" ng-show="actionShowed(action, row)" target="_blank">{{ action.title | i18n }}</a>&nbsp;</span></div><div class="action-confirmation-block" ng-if="rowState(row) == &#39;confirmation&#39;"><span class="question" ng-bind="rowConfirmation(row).text"></span><a class="btn btn-danger btn-xs" ng-click="doAction($event, rowAction(row), row, true)" ng-href="{{actionUrl(rowAction(row), row)}}" target="_blank">{{ rowConfirmation(row).yesText || \'sure\' | i18n }}</a>&nbsp;<button class="btn btn-default btn-md" ng-click="cancel(row)">{{ rowConfirmation(row).noText || \'cancel\' | i18n }}</button></div></td>')}]),angular.module("vasvitaly.angular-pagination").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("pagination/pagination.html",'<nav ng-if="pagination.isVisible()"><ul class="pagination"><li ng-class="{disabled: !pagination.havePreviousPage()}"><a aria-label="{{&#39;previous_page&#39; | i18n : &#39;pagination&#39;}}" href="" ng-click="pagination.setPage(pagination.previousPage())"><span aria-hidden="true">&laquo;</span></a></li><li ng-class="{active: pagination.isCurrentPage(page)}" ng-repeat="page in pagination.pages()"><a href="" ng-click="pagination.setPage(page)">{{page}}</a></li><li ng-class="{disabled: !pagination.haveNextPage()}"><a aria-label="{{&#39;next_page&#39; | i18n : &#39;pagination&#39;}}" href="" ng-click="pagination.setPage(pagination.nextPage())"><span aria-hidden="true">&raquo;</span></a></li></ul><div class="pagination-info" ng-if="pagination.options.showInfo"><span class="page">{{\'rows\' | i18n : \'pagination\'}} </span><span class="page-limit">{{pagination.firstItemNumber()}} - {{pagination.lastItemNumber()}}</span><span class="of">{{\'of-count\' | i18n : \'pagination\'}}</span><span class="total">{{pagination.totalCount()}}</span></div></nav>')}]);