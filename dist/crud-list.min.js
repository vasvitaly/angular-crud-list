"use strict";var vvvCrudListController=function($scope){var actionConfirmations={remove:{yesText:"remove_completely",noText:"cancel"}},actionCssClasses={"new":"btn-primary",remove:"btn-danger btn-xs",edit:"btn-info btn-md"};$scope.errors=[],$scope.showActions={},$scope.columns=$scope.options.columns,$scope.modelName=$scope.options.modelName,$scope.rowTpl=function(row){return row&&row.state?"crud-list/edit_row.html":"crud-list/row.html"},$scope.cellTpl=function(column){return column.templateUrl?column.templateUrl:column.url?"crud-list/link.html":"crud-list/plain_value.html"},$scope.formattedValue=function(row,column){var value=oValue(row,column.fieldId.split("."));return column.formatter&&angular.isFunction(column.formatter)?column.formatter(value):value},$scope.newRowTpl=function(){return $scope.row&&"new"==$scope.row.state?"crud-list/add_form.html":""},$scope["new"]=function(){return $scope.row=$scope.dataSource.newRecord(),$scope.row.state="new",$scope.row},$scope.cancel=function(row){return row.state=null,row.action=null,!1},$scope.save=function(row,oForm){return oForm.$invalid?!1:(clearRowErrors(row),void $scope.dataSource.save(row,!0,onSuccessSave.bind(this)))},$scope.remove=function(row){return $scope.dataSource.remove(row.id),row},$scope.actionUrl=function(action,row){if(action.url){var resUrl=action.url;return 0===resUrl.indexOf("/")&&(resUrl="#"+resUrl),row?populateUrl(resUrl,row):resUrl}return""},$scope.doAction=function(action,row){return action.confirmation?(row.confirmation=action.confirmation,row.action=action,!1):(action.action&&(row=$scope.doConfirmedAction(action,row)),action.templateUrl&&(row.state=action.name),!1)},$scope.doConfirmedAction=function(action,row){var results;return action.before&&angular.isFunction(action.before)&&action.before(row),results=action.action(row),action.after&&angular.isFunction(action.after)&&action.after(row||results),row||results},$scope.cancelAction=function(row){row.confirmation=null},$scope.actionCssClass=function(action){return action.cssClass||actionCssClasses[action.name]||""};var checkRowActions=function(){checkActions("row")},checkListActions=function(){checkActions("list")},checkActions=function(target){var actions,action,actionName,actionsLength=0;if(target+="Actions",$scope[target]={},$scope.options[target]){actions=$scope.options[target];for(actionName in actions){if(action=actions[actionName],action.name=actionName,!isActionCorrect(action))return!1;$scope[target][actionName]=action,actionsLength+=1}}$scope.showActions[target]=actionsLength>0},isActionCorrect=function(action){if(action.title&&""!==action.title||(action.title=action.name),!(action.url&&""!==action.url||action.action&&angular.isFunction(action.action)))if("new"==action.name||"remove"==action.name)action.action=$scope[action.name],action.confirmation!==!1&&!action.confirmation&&actionConfirmations[action.name]&&(action.confirmation=actionConfirmations[action.name]);else if(!action.templateUrl||""===action.templateUrl)return $scope.errors.push('Action "'+action.name+'" has nothing to do.'),!1;return!0},populateUrl=function(url,data){var i,places,property;if(places=url.match(/\:[^\/\:\.]+/g))for(i=0;i<places.length;i++)property=places[i].replace(":",""),data.hasOwnProperty(property)&&(url=url.replace(places[i],data[property]));return url},onSuccessSave=function(row){row.state=null,$scope.row&&$scope.row.id==row.id&&($scope.row=null)},clearRowErrors=function(row){row.errors={}},oValue=function(obj,keys){var key;return key=keys.shift(),keys.length>0&&obj[key]&&"object"==typeof obj[key]?oValue(obj[key],keys):obj[key]};return checkRowActions(),checkListActions(),!0};angular.module("vasvitaly.angular-crud-list",[]).directive("vvvCrudList",[function(){return{restrict:"AE",templateUrl:"crud-list/main.html",scope:{options:"=",dataSource:"=source"},controllerAs:"crudList",controller:["$scope",vvvCrudListController]}}]).filter("i18n",function(){return function(key,prefix){return prefix?(prefix=prefix.split("."),"ARA"==prefix[0]?(prefix.shift(),prefix=["activerecord","attributes"].concat(prefix.slice(1,prefix.length))):"ARM"==prefix[0]?prefix=["activerecord","models"].concat(prefix.slice(1,prefix.length)):"enum"==prefix[0]&&(prefix=["enumerize","defaults"].concat(prefix.slice(1,prefix.length)))):prefix=[],prefix.push(key),window.I18n.t(prefix,{defaultValue:key})}}),angular.module("vasvitaly.angular-crud-list").run(["$templateCache",function($templateCache){$templateCache.put("crud-list/add_button.html",'<div class="col-md-2"><a class="btn btn-primary" ng-click="new()" ng-href="{{newUrl()}}">{{\'add_new\' | i18n : options.actionsScope.currentPage }}</a></div>'),$templateCache.put("crud-list/add_form.html",'<h2 class="sub-header">{{\'add_new\' | i18n : options.actionsScope.currentPage }}</h2><div class="row"><div class="col-md-12" ng-include="listActions.new.templateUrl || rowActions.edit.templateUrl"></div></div>'),$templateCache.put("crud-list/edit_row.html",'<td class="row" colspan="{{columns.length+1}}"><div class="col-md-12" ng-include="rowActions[row.state].templateUrl"></div></td>'),$templateCache.put("crud-list/link.html",'<a ng-bind="formattedValue(row, column)" ng-href="{{actionUrl(column, row)}}" target="_blank"></a>'),$templateCache.put("crud-list/main.html",'<div ng-if="errors.length &gt; 0"><p ng-bind="error" ng-repeat="error in errors"></p></div><div ng-if="errors.length == 0"><div class="row listActionsPanel" ng-if="showActions.listActions"><span ng-repeat="action in listActions"><a class="btn" ng-class="actionCssClass(action)" ng-click="doAction(action, row)" ng-href="{{actionUrl(action)}}" target="_blank">{{ action.title | i18n }}</a>&nbsp;</span></div><div class="row" ng-include="newRowTpl()"></div><br><div class="row items-list"><div class="table-responsive"><table class="table table-striped"><thead><tr><th ng-class="{&#39;clickable&#39;: !column.notSortable}" ng-click="dataSource.sortBy(column.fieldId)" ng-repeat="column in columns" width="{{column.width || &#39;*&#39;}}"><span class="icon" ng-class="{ordered: dataSource.isOrderedByField(column.fieldId), reverse: dataSource.sortingInfo().desc}" ng-if="!column.notSortable"></span><span ng-bind="modelName + &#39;.&#39; + column.title | i18n : column.titlePrefix"></span></th><th ng-show="showActions">{{\'actions\' | i18n}}</th></tr></thead><tbody><tr ng-include="rowTpl(row)" ng-repeat="row in dataSource.filteredRows()"></tr></tbody></table></div></div></div>'),$templateCache.put("crud-list/plain_value.html",'<span ng-bind="formattedValue(row, column)"></span>'),$templateCache.put("crud-list/row.html",'<td ng-include="cellTpl(column)" ng-repeat="column in columns"></td><td class="actions" ng-if="showActions.rowActions"><div class="action-block" ng-show="!row.confirmation"><span ng-repeat="action in rowActions"><a class="btn" ng-class="actionCssClass(action)" ng-click="doAction(action, row)" ng-href="{{actionUrl(action, row)}}" target="_blank">{{ action.title | i18n }}</a>&nbsp;</span></div><div class="action-confirmation-block" ng-if="row.confirmation"><span class="question" ng-bind="row.confirmation.text"></span><button class="btn btn-danger btn-xs" ng-click="doConfirmedAction(row.action,row)">{{ row.confirmation.yesText || \'sure\' | i18n }}</button>&nbsp;<button class="btn btn-default btn-md" ng-click="cancelAction(row)">{{ row.confirmation.noText || \'cancel\' | i18n }}</button></div></td>')}]);